PRINT "--- Advanced OOP & Closure Test ---"

# This function creates a 'greeter' function
DEF create_greeter(greeting)
  DEF greeter_func(name)
    RETURN greeting + ", " + name + "!"
  ENDEF
  RETURN greeter_func
ENDEF

PRINT "Creating greeter functions..."
LET say_hello = create_greeter("Hello")
LET say_hi = create_greeter("Hi")

# Create a class that holds a function
CLASS Person
  DEF init(SELF, name, greeter_func)
    SELF.name = name
    SELF.greeter = greeter_func # Store the function as an attribute
  ENDEF
  
  DEF greet(SELF)
    # Call the stored function, passing in our name
    LET message = SELF.greeter(SELF.name)
    PRINT message
  ENDEF
ENDCLASS

PRINT "--- Creating people ---"
LET alex = NEW Person("Alex", say_hello)
LET bob = NEW Person("Bob", say_hi)

PRINT "--- Testing method calls ---"
alex.greet() # Should print "Hello, Alex!"
bob.greet()  # Should print "Hi, Bob!"

# --- Re-assigning an attribute ---
PRINT "--- Re-assigning attribute ---"
alex.greeter = say_hi # Change Alex's greeter function
alex.greet() # Should now print "Hi, Alex!"